import * as $ from '../gameObject/index.js'
import Vec2 from '../Vector.js'

export function Prologue(game) {
  game.levelData = {
    introDialogue: 'prologue/intro',
    background: 'raincity',
    spawnpoint: new Vec2(595, 392),
    cameraHeight: 216,
    cameraBound: {
      x: 480,
      y: 272,
      width: 1000,
      height: 180,
    },
    tileWidth: 200,
    tileHeight: 90,
    onUpdate: async (dt, game, $) => {
      $('wake_up').r.y += dt * 60
      if($('qie1').flying)
      $('qie1').r.subTo(0, dt * 80)
      const d = game.levelData
      if(d.collectId && !d.collectOK && d.collectCount >= d.collectTotal) {
      game.levelData.collectOK = true
      game.sound.play('bonus')
      $('qie2').dialogueId = 'prologue/finish'
      }
    },

    collectId: 'sprite/linggangu',
    collectCount: 0,
    collectTotal: 5,
  }

  game.tilePalette = ["Air","LumpyCementGrass","AutumnGrassDead","PaleLimestone","LumpyCementGrass","LumpyCementAutumnGrass","LumpyCement","Straw","LumpyCementSnow","BalatroSilver"]

  game.tileData = [
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         11111111111111111111111111                                                                                                                                                     ',
    '                         1111111111111111111111111             8                                                                                                                                        ',
    '                         1111111111111111111111111            88                                                                                                                                        ',
    '                         1111111111111111111111111            88                                                                                                                                        ',
    '                         111111111111111111111111             888                                                                                                                                       ',
    '                         111111111111111111111111            8888                                                                                                                                       ',
    '                         111111111111111111111111            88888                                                                                                                                      ',
    '                         111111111111111111111111            88888                                                                                                                                      ',
    '                         111111111111111111111111           888888                                                                                                                                      ',
    '                         111111111111111111111111           8868888                                                                                  444444                                             ',
    '                         111111111111111111111111           8818888                                                                                 44444444                  4411111111111111111111    ',
    '                         111111111111111111111111          888188888                                                  444444444444                444444444444              444411111111111111111111    ',
    '                         111111111111111111111111          888686668                                                  4444444444444444444444444444444444444444444444441  144444411144111111111111111    ',
    '                         1111111111111111111111111         1118866444                                                 4444144444444444444444444444444444444444444444441  144444444444111111111111111    ',
    '                         111111111111111111111111111      188888886444                                                     11111111111444444444444444444444444444444411  144444444444111111111111111    ',
    '                         111111111111111111111111111111111111888888444                                                       111111666664444444444444444444444444111411  111444444444111111111111111    ',
    '                         111111111111111111111111111111111118888888414                                                       11111    144444444444444444444444441111111  111144444444111111111111111    ',
    '                         1111111111111111111111111111111111188888848141                                                               144444444444444444444444441111111  111144444444111111111111111    ',
    '                         11111111111111111111111111111111111888888881111                  1111                                        144444444444444444444444441111111  111114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888111111111111111      1111       11111               66666   66   664444444444444444444444411111111  111114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888111111111111111     66614       1111111             44446   6666664444444444444444444444441111111555511114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     66644       1144641             444666666666666444444444444444444444441111111666511114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444641             444411111644444444444444444444444444441111115555555114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444666666644444444444444444444444444441111115555555114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444111115555555114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444415555555114444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444415555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444415555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444445555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444441115555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444441115555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444441115555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444115555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444115555555444444444111111111111111    ',
    '                         11111111111111111111111111111111111888888888811111111111111     44444       4444441             444444444444444444444444444444444444444444115555555444444444111111111111111    ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                                                                                                                                                                                        ',
    '                                  99999999999999999999999999999999999999999999999999999999999999999999999999999                                                                                         ',
    '                                  9                                                                           9                                                                                         ',
    '                                  9 9   9  99  999  9999     999  9   9     9999 9  9  99  999  9    999 9999 9                                                                                         ',
    '                                  9 99 99 9  9 9  9 9        9  9  9 9      9    9  9 9  9 9  9 9     9  9    9                                                                                         ',
    '                                  9 9 9 9 9999 9  9 999      999    9       9    9999 9999 999  9     9  999  9                                                                                         ',
    '                                  9 9 9 9 9  9 9  9 9        9  9   9       9    9  9 9  9 9  9 9     9  9    9                                                                                         ',
    '                                  9 9   9 9  9 999  9999     9999   9       9999 9  9 9  9 9  9 9999 999 9999 9                                                                                         ',
    '                                  9                                                                           9                                                                                         ',
    '                                  99999999999999999999999999999999999999999999999999999999999999999999999999999                                                                                         ',
    '                                                                                                                                                                                                        ',
  ]

  game.sound.playBGM('Home')

  game.gameObjects.push(

    new $.CameraController(296, 224, 400, 225, -192, 0, 1, 225).hide(),
    new $.CameraController(504, 244, 976, 208, -40, -16, 1, 180).hide(),
    new $.Collectible(822, 398, 'sprite/linggangu', false, async (game, $) => {
      game.levelData.collectCount++
    }),
    new $.Collectible(898, 299, 'sprite/linggangu', false, async (game, $) => {
      game.levelData.collectCount++
    }),
    new $.Collectible(982, 398, 'sprite/linggangu', false, async (game, $) => {
      game.levelData.collectCount++
    }),
    new $.Collectible(1057, 406, 'sprite/strawberry', false, null),
    new $.Collectible(1102, 302, 'sprite/linggangu', false, async (game, $) => {
      game.levelData.collectCount++
    }),
    new $.Collectible(1214, 262, 'sprite/linggangu', false, async (game, $) => {
      game.levelData.collectCount++
    }),
    new $.Collectible(1342, 406, 'sprite/strawberry', false, null),
    new $.Hazard(504, 256, 8, 8, 'up'),
    new $.Hazard(512, 280, 8, 8, 'up'),
    new $.Hazard(664, 472, 456, 8, 'up').hide(),
    new $.Hazard(1008, 416, 24, 8, 'up'),
    new $.Hazard(1040, 344, 128, 8, 'up'),
    new $.Hazard(1336, 360, 8, 40, 'right'),
    new $.Hazard(1344, 360, 8, 40, 'left'),
    new $.Interactable(436, 360, 16, 16, 'prologue/easter_egg', 'character/dingzhen/normal', '？？？', false, async (game, $) => {
      game.achievement.add('i_am_my_own_grandpa')
    }),
    new $.Interactable(504, 296, 312, 32, 'prologue/wake_up', '', '', true, null).ref('wake_up').hide(),
    new $.Interactable(619, 392, 16, 16, 'prologue/tutorial', 'character/zhishiqie/normal', '按E键对话', false, async (game, $) => {
      $('qie1').dialogueId = null
      $('qie1').flying = true
      game.sound.play('mysterygo')
    }).ref('qie1'),
    new $.Interactable(1296, 336, 16, 16, '', 'sprite/sign', '这些刺其实没有看上去那么大。', false, null),
    new $.Interactable(1432, 320, 16, 16, 'prologue/not_finish', 'character/zhishiqie/normal', '芝士企鹅', false, async (game, $) => {
      if(game.levelData.collectOK)
      $('levelChanger').r.y = 300
    }).ref('qie2'),
    new $.LevelChanger(712, 400, 8, 16, '测试大厅', false).hide(),
    new $.LevelChanger(1416, 184, 48, 48, 'Stage1', true).ref('levelChanger').hide(),
    new $.MovingPlatform(new Vec2(880, 416), new Vec2(880, 336), 40, 8, false, 4, 'sin'),
    new $.MovingPlatform(new Vec2(1048, 336), new Vec2(1136, 336), 24, 8, false, 4, 'linear'),
    new $.Platform(1200, 304, 32, 8, true),
    new $.Trigger(952, 296, 216, 48, false, async (game, $) => {
      game.levelData.spawnpoint = new Vec2(1003, 328)
    }, null).hide(),
    new $.Trigger(1176, 296, 192, 48, false, async (game, $) => {
      game.levelData.spawnpoint = new Vec2(1275, 336)
    }, null).hide(),
    new $.Trigger(1336, 408, 16, 16, false, async (game, $) => {
      game.player.jumpSpeed *= 2
    }, async (game, $) => {
      game.player.jumpSpeed /= 2
    }).hide()
  )
}
